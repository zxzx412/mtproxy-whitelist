# HAProxy配置示例 - 支持PROXY Protocol传递真实IP
# 解决NAT环境下MTProxy白名单无法获取真实客户端IP的问题

global
    maxconn 4096
    log stdout local0 info

defaults
    mode tcp
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    log global

# 前端监听 - 接收客户端连接
frontend mtproxy_frontend
    bind *:14202
    default_backend mtproxy_backend

# 后端服务 - 转发到MTProxy并发送PROXY Protocol头
backend mtproxy_backend
    # 发送PROXY Protocol v2头，包含真实客户端IP
    server mtproxy1 127.0.0.1:445 send-proxy-v2 check





