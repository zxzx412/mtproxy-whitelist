# ============================================================
# MTProxy 白名单系统配置文件 v5.0
# ============================================================
# 复制此文件为 .env 并根据需要修改配置
#
# 重构说明：
# - v5.0 引入标准化端口变量命名
# - 支持三种部署模式：bridge、nat-direct、nat-haproxy
# - 旧变量名继续兼容但会显示废弃警告
#
# 配置验证：
#   bash docker/validate-config.sh
# ============================================================

# ============================================================
# 部署模式配置（新增）
# ============================================================

# 部署模式选择：
#   bridge       - Docker桥接网络模式（默认，适用于大多数场景）
#   nat-direct   - NAT直连模式（主机网络，nginx直接绑定外部端口）
#   nat-haproxy  - NAT+HAProxy模式（主机网络，通过PROXY Protocol获取真实IP）
#
# 说明：
# - bridge模式：Docker自动处理端口映射，最简单
# - nat-direct：需要主机网络权限，适合VPS/独立服务器
# - nat-haproxy：NAT环境下获取客户端真实IP，适合多层NAT

DEPLOYMENT_MODE=bridge

# ============================================================
# 外部端口配置（用户可见端口）
# ============================================================

# MTProxy代理服务端口（客户端连接此端口）
EXTERNAL_PROXY_PORT=14202

# Web管理界面端口
EXTERNAL_WEB_PORT=8989

# ============================================================
# 内部端口配置（高级用户）
# ============================================================
# 注意：以下配置通常不需要修改，除非有端口冲突

# PROXY Protocol内部端口（HAProxy模式使用）
# v5.0默认改为14445，避免Windows SMB端口445冲突
INTERNAL_PROXY_PROTOCOL_PORT=14445

# MTProxy后端监听端口（内部通信）
BACKEND_MTPROXY_PORT=444

# API服务内部端口
INTERNAL_API_PORT=8080

# ============================================================
# MTProxy 业务配置
# ============================================================

# 伪装域名（用于流量混淆）
# 推荐使用知名域名，如：azure.microsoft.com, www.cloudflare.com
MTPROXY_DOMAIN=azure.microsoft.com

# MTProxy TAG（可选，用于Telegram官方统计）
# 申请地址：https://t.me/MTProxybot
MTPROXY_TAG=

# ============================================================
# API 安全配置
# ============================================================

# Flask SECRET_KEY（用于会话加密）
# 生产环境务必修改为随机字符串
SECRET_KEY=ee004d64da8e145b8daa35a2012e220e

# JWT Token 过期时间（小时）
JWT_EXPIRATION_HOURS=24

# 管理员密码
# ⚠️ 生产环境务必修改默认密码！
ADMIN_PASSWORD=admin123

# ============================================================
# 向后兼容配置（v6.0将移除）
# ============================================================
# 以下变量已废弃，仅为兼容旧版本配置保留
# 请尽快迁移到新变量名

# ❌ 已废弃: MTPROXY_PORT → 请使用 EXTERNAL_PROXY_PORT
# ❌ 已废弃: WEB_PORT → 请使用 EXTERNAL_WEB_PORT
# ❌ 已废弃: NAT_MODE → 请使用 DEPLOYMENT_MODE
# ❌ 已废弃: PROXY_PROTOCOL_PORT=445 → 改用 INTERNAL_PROXY_PROTOCOL_PORT=14445

# 旧变量映射（自动处理，无需手动配置）：
# MTPROXY_PORT=${EXTERNAL_PROXY_PORT}
# WEB_PORT=${EXTERNAL_WEB_PORT}

# ============================================================
# 环境变量优先级说明
# ============================================================
# 1. .env文件中的配置
# 2. docker-compose.yml中的environment配置
# 3. 系统环境变量
# 4. 代码中的默认值
#
# 推荐做法：
# - 开发环境：使用.env文件
# - 生产环境：使用docker-compose.yml或系统环境变量
# ============================================================
